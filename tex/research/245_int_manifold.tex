% This is part of Giulietta
% Copyright (c) 2010-2017, 2019, 2021-2022, 2024
%   Laurent Claessens
% See the file fdl-1.3.txt for copying conditions.


%+++++++++++++++++++++++++++++++++++++++++++++++++++++++
\section{Integral of differential forms}
%+++++++++++++++++++++++++++++++++++++++++++++++++++++++

\begin{propositionDef}[Integral of a differential form on a manifold]       \label{DEFooOMQLooGiJWZS}

	Let \( M\) be a manifold. Let \(  \{ (\varphi_i,U_i) \}_{i\in I}\) and \( \{ (\psi_j,V_j) \}_{j\in J}\) be two atlas of \( M\). We consider \( \{ f_i \}_{i\in I}\) and \( \{ g_j \}_{j\in J}\) be parition of the unity subordinated to the respective two atlases.

	Then we have
	\begin{equation}
		\sum_{i\in I}\int_{\varphi_i(U_i)}f_i\omega=\sum_{j\in J}\int_{\psi_j(V_j)}g_j\omega.
	\end{equation}
	This number is the \defe{integral of \( \omega\) on \( M\)}{integral of a differential form} and is denoted by
	\begin{equation}
		\int_M\omega
	\end{equation}
\end{propositionDef}


%+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
\section{Integration of a differential form}
%+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

%---------------------------------------------------------------------------------------------------------------------------
\subsection{Open set in \( \eR^n\)}
%---------------------------------------------------------------------------------------------------------------------------

Let \( U\) be an open set of \( \eR^n\). A differential form of degree \( n\) over \( U\) can always be written under the form
\begin{equation}
	\omega_x=f(x)dx_1\wedge\ldots\wedge dx_n;
\end{equation}
this is proposition~\ref{ProprbjihK}.

\begin{definition}      \label{DEFooEYRFooRQTmRF}
	The integral of \( \omega\) on \( U\) is
	\begin{equation}
		\int_{U}f\,dx_1\wedge\ldots\wedge dx_n=\int_Uf
	\end{equation}
	The second integral is the integral of a function on \( \eR^n\), that is definition~\ref{DefTVOooleEst} where the measure is the Lebesgue measure on \( \eR^n\).
\end{definition}

\begin{lemma}[Change of variable]       \label{LEMooNCYSooXtnCKq}
	Let \( f\colon V\to U\) be a diffeomorphism of open sets in \( \eR^n\) and \( \omega\) be a \( n\)-form on \( U\). Then we have
	\begin{equation}
		\int_U\omega=\int_{f^{-1}(U)}f^*\omega
	\end{equation}
	if \( \det(f)>0\). A sign change if \( \det(df)<0\).
\end{lemma}

\begin{proof}
	Let, for \( y\in U\), write the form \( \omega\) as \( \omega_y=h(y)dy_1\wedge\ldots\wedge dy_n\). Taking \( v_i\in \Gamma(TV)\) we have
	\begin{subequations}
		\begin{align}
			(f^*\omega)_x(v_1,\ldots, v_n) & =\omega_{f(x)}\big( df_xv_1,\ldots, df_xv_n \big)                       \\
			                               & =h\big( f(x) \big)\det\begin{pmatrix}
				                                                       df_xv_1 \\
				                                                       \vdots  \\
				                                                       df_xv_n
			                                                       \end{pmatrix}                                    \\
			                               & =(h\circ f)(x)\det(df_x)\det\begin{pmatrix}
				                                                             v_1    \\
				                                                             \vdots \\
				                                                             v_n
			                                                             \end{pmatrix}                              \\
			                               & =(h\circ f)(x)\det(df_x)(dx_1\wedge\ldots\wedge dx_n)(v_1,\ldots, v_n).
		\end{align}
	\end{subequations}
	Thus
	\begin{equation}
		f^*\omega= (h\circ f)\det(df)dx_1\wedge\ldots\wedge dx_n
	\end{equation}
	Using the usual change of variable theorem~\ref{THOooUMIWooZUtUSg}\ref{ITEMooAJGDooGHKnvj} (and taking a sign if \( \det(df)<0\) because there is an absolute value in around the jacobian in \eqref{EQooLYAWooTArAZR}) :
	\begin{equation}
		\int_{f^{-1}(U)}f^*\omega=\int_V(h\circ f)\det(df)=\int_{f(V)}h=\int_Uh=\int_U\omega.
	\end{equation}
\end{proof}

That is for integrating a differential form on an open set of \( \eR^n\). In order to integrate on a manifold we ``simply'' use a pull-back with a chart system. There will be three complications
\begin{itemize}
	\item If an atlas is made from more than one chart, what about the intersections ?
	\item Independence with respect to the choice of the chart.
	\item Integrating a vector field (that is not obviously a \( n\)-form).
\end{itemize}

%---------------------------------------------------------------------------------------------------------------------------
\subsection{One chart on a manifold}
%---------------------------------------------------------------------------------------------------------------------------

We suppose \( (M,g)\) to be a \( n\)-dimensional Riemannian manifold and \( S\) to be a \( (n-1)\)-dimensional submanifold. We suppose that both are inside only one chart
\begin{equation}
	\phi\colon U\subset \eR^n\to M
\end{equation}
and
\begin{equation}
	\varphi\colon A\subset \eR^{n-1}\to S.
\end{equation}
We also consider a differential form \( \omega\in \Wedge^n(T^*M)\) and \( \sigma\in\Wedge^{n-1}(T^*M)\). These are respectively \( n\) and \( n-1\) differential forms on \( M\).  We also consider \( v\), a vector field on \( M\) and \( \tau\), a \( 1\)-form on \(M\).

Let us see what is possible to integrate.

\begin{definition}[\cite{ooMLEZooCKxedX}]       \label{DEFooPDRCooPiBklC}
	Let \( \omega\) be a \( n\)-form defined on \( \phi(U)\) (vanishing everywhere else). Its integral is :
	\begin{equation}
		\int_{\phi(U)}\omega=\int_U\phi^*\omega.
	\end{equation}
	The last integral is an integral of type \( \int_{U}F(x_1,\ldots, x_n)dx_1\wedge\ldots \wedge dx_n\) on an open set in \( \eR^n\). That is definition~\ref{DEFooEYRFooRQTmRF}.
\end{definition}

This definition is nothing if it depend on the parametrisation. The following proposition show slightly more than the independence.
\begin{proposition}[\cite{MonCerveau,ooBTXRooUEBLMV}]       \label{PROPooNJCLooMqeeeX}
	Let be the charts \( \phi\colon U\to M\) and \( \psi\colon V\to N\) and a map \( f\colon M\to N\). The whole is supposed to be minimal :
	\begin{equation}
		f\big( \phi(U) \big)=\psi(V).
	\end{equation}
	Then we have the ``change of variable'' formula :
	\begin{equation}
		\int_{\phi(U)}\omega=\int_{\psi(V)}(f^{-1})^*\omega.
	\end{equation}
\end{proposition}

\begin{proof}
	By definition \( \int_{\phi(U)}\omega=\int_U\phi^*\omega\) and we have the diffeomorphism
	\begin{equation}
		\phi^{-1}\circ f^{-1}\circ \psi\colon V\to U,
	\end{equation}
	so that we can use the result of lemma~\ref{LEMooNCYSooXtnCKq} :
	\begin{equation}
		\int_U\phi^*\omega=\int_{(\phi^{-1}\circ f^{-1}\circ \psi)^{-1}(U)}  (\phi^{-1}\circ f^{-1}\circ \psi)^*\phi^*\omega=\int_{(\psi^{-1}\circ f\circ \phi )U}\psi^*(f^{-1})^*\omega=\int_{\psi^{-1}(N)}\psi^*(f^{-1})^*\omega.
	\end{equation}
	The last integral is the definition of an integral on \( N\) :
	\begin{equation}
		\int_{\psi^{-1}(N)}\psi^*(f^{-1})^*\omega=\int_N(f^{-1})^*\omega.
	\end{equation}
\end{proof}

Here is the lemma that shows the independence of definition~\ref{DEFooPDRCooPiBklC} with respect to the change of chart system.
\begin{lemma}
	Let \( \varphi\colon V\to M\) be a chart such that \( \varphi(V)\cap \varphi(U)=N\) is not empty. We define \( U'=\phi^{-1}(N)\) and \( V'=\varphi^{-1}(N)\). Then
	\begin{equation}        \label{EQooLSZMooPcyMWN}
		\int_{\phi(U')}\omega=\int_{\varphi(V')}\omega.
	\end{equation}
\end{lemma}
This lemma allows us to write \( \int_N\omega\) the common value of both sides of \eqref{EQooLSZMooPcyMWN}.

\begin{proof}
	Taking \( f=\id\) and two charts for the same open set in \( M\) in proposition~\ref{PROPooNJCLooMqeeeX} shows the result.
\end{proof}

%---------------------------------------------------------------------------------------------------------------------------
\subsection{On manifold that require a finite atlas}
%---------------------------------------------------------------------------------------------------------------------------

We restrict ourself to manifolds that accept a finite atlas.

\begin{definition}[\cite{ooBTXRooUEBLMV}]      \label{DEFooITDTooWwrPPr}
	If \( \omega\) is a \( n\)-form on \( M\) and if \( \{ f_{\alpha} \} \) is a partition of unity\footnote{See theorem~\ref{THOooPCHDooITWKpC}.} subordinate to the finite atlas \( \{ U_{\alpha} \}\) then
	\begin{equation}
		\int_M\omega=\sum_{\alpha}\int_{\phi_{\alpha}(U_{\alpha})}f_{\alpha}\omega.
	\end{equation}
\end{definition}

We show that this definition does not depend on the choice of the partition of unity.
\begin{lemma}[\cite{MonCerveau,ooBTXRooUEBLMV}] \label{LEMooCMIZooHhHaHV}
	The definition~\ref{DEFooITDTooWwrPPr} is independent of the choice of atlas and partition of unity.
\end{lemma}

\begin{proof}
	Let \(  \{ U_{\alpha},\phi_{\alpha},f_{\alpha} \}_{\alpha\in A}  \) and \( \{ V_i,\varphi_i,g_i \}_{i\in I}\) be two choices of atlas, charts and subordinate partition of unity. We have to show that
	\begin{equation}        \label{EQooPVQZooHvbioJ}
		\sum_{\alpha\in A}\int_{\phi_{\alpha}(U_{\alpha})}f_{\alpha}\omega=\sum_{i\in I}\int_{\varphi_i(V_i)}g_i\omega.
	\end{equation}
	Since \( \{ g_i \}\) is a partition of unity,
	\begin{equation}
		\spadesuit=\sum_{\alpha}\int_{\phi_{\alpha}(U_{\alpha})}f_{\alpha}\omega=\sum_{\alpha}\int_{\phi_{\alpha}(U_{\alpha})}\sum_ig_if_{\alpha}\omega.
	\end{equation}
	Since the atlas are finite, the sums are finite and can be permuted with the integral. Moreover the function \( g_if_{\alpha}\) is nonzero only on \( \phi_{\alpha}(U_{\alpha})\cap\varphi_i(V_i)\) so that the integral can be taken on \( \phi_{\alpha}(U_{\alpha})\), \( \phi_{\alpha}(U_{\alpha})\cap\varphi_i(V_i)\) or \( \varphi_i(V_i)\). We have
	\begin{subequations}
		\begin{align}
			\spadesuit=\sum_i\sum_{\alpha}\int_{\phi_{\alpha(U_{\alpha})}}g_if_{\alpha}\omega & =  \sum_i\sum_{\alpha}\int_{\phi_{\alpha(U_{\alpha})}\cap \varphi_i(V_i)}g_if_{\alpha}\omega \\
			                                                                                  & =  \sum_i\sum_{\alpha}\int_{\varphi_i(V_i)}g_if_{\alpha}\omega                               \\
			                                                                                  & = \sum_i\int_{\varphi_i(V_i)}g_i\sum_{\alpha}f_{\alpha}\omega                                \\
			                                                                                  & =\sum_i\int_{\varphi_i(V_i)}g_i\omega.
		\end{align}
	\end{subequations}
\end{proof}
The common values of both sides of \eqref{EQooPVQZooHvbioJ} is denoted by \( \int_M\omega\).

The following is not really a definition, but a particular case of~\ref{DEFooPDRCooPiBklC}. The integral of a \( n-1\)-form on a \( (n-1)\)-submanifold is
\begin{equation}        \label{EQooYPOGooRYOXQe}
	\int_S\sigma=\int_A\varphi^*\sigma.
\end{equation}
Once again the last integral is an integral of a \( n-1\)-form on an open set in \( \eR^{n-1}\).

\begin{definition}[\cite{ooMLEZooCKxedX}]       \label{DEFooAXFXooWiMLKP}
	The integral of a \( 1\)-form on a \( n-1\) dimensional submanifold is :
	\begin{equation}
		\int_S\tau=\int_S\hodge\tau
	\end{equation}
	where \( \hodge\) is the Hodge dual defined by~\ref{DEFooUOJQooSzKjNR}.
\end{definition}
The last integral is the integral of a \( (n-1)\)-form on a \( (n-1)\)-submanifold, given by \eqref{EQooYPOGooRYOXQe}.

\begin{definition}      \label{DEFooAXZGooJairMQ}
	The integral of a vector field on a \( (n-1)\)-submanifold is :
	\begin{equation}
		\int_Sv=\int_Sv^{\flat}
	\end{equation}
	where \( v^{\flat}\) is the \( 1\)-form defined by the musical isomorphism \eqref{EQooBTWXooTqoNxa}.
\end{definition}

The following proposition provides a much more explicit formula for the integral of a vector field.

\begin{proposition}     \label{PROPooETLZooAVsrwy}
	Let \( \varphi\colon A\subset \eR^{n-1}\to \eR^n\) be an hypersurface and \( X\) be a vector field in \( \eR^n\). Then
	\begin{subequations}
		\begin{align}
			\int_SX & =\int_A\det\big( X,\frac{ \partial \varphi }{ \partial y_1 },\ldots, \frac{ \partial \varphi }{ \partial y_{n-1} } \big)  \label{SUBEQooWJSPooImJjQN} \\
			        & =\int_A X\cdot\det\begin{pmatrix}
				                            e_1 & \ldots                    & e_n \\
				                                & \partial_{y_1}\varphi     &     \\
				                                & \vdots                    &     \\
				                                & \partial_{y_{n-1}}\varphi &
			                            \end{pmatrix}                                                                         \\
			        & =\int_A X\cdot n
		\end{align}
	\end{subequations}
	where \( \{ y_1,\ldots, y_{n-1} \}\) are the coordinates on \( A\) and \( n\) is the normal vector to the parametrization.
\end{proposition}
Note : thanks to lemma~\ref{LEMooCMIZooHhHaHV}, the value of \( n\) can depend on the choice of coordinates, but the integral will not depend.

\begin{proof}
	If \( X=\sum_{i=1}^nX_i\partial_i\), then \( X^{\flat}=\sum_{i}X_idx_i\) and its Hodge dual is
	\begin{equation}
		\sum_{i}(-1)^i dx_1\wedge\ldots\wedge\widehat{dx_i}\wedge\ldots\wedge dx_n
	\end{equation}
	where the hat denotes a factor that is not present. Using the definitions~\ref{DEFooAXZGooJairMQ},~\ref{DEFooAXFXooWiMLKP} and~\ref{DEFooPDRCooPiBklC} it remains to integrate
	\begin{equation}
		\int_A\sum_i(-1)^iX_i\varphi^*\big( dx_1\wedge\ldots\wedge\widehat{dx_i}\wedge\ldots\wedge dx_n \big).
	\end{equation}
	If \( u_1,\ldots, u_{n-1}\) are vectors on \( A\) (that is on \( T_xA\) where \( x\) is the integration variable) we have
	\begin{subequations}
		\begin{align}
			\varphi^*(dx_1\wedge\ldots\wedge \widehat{dx_i}\wedge\ldots\wedge dx_n)(u_1,\ldots, u_{n-1}) & = (dx_1\wedge\ldots\wedge \widehat{dx_i}\wedge\ldots\wedge dx_n)(d\varphi u_1,\ldots, d\varphi u_{n-1}) \\
			                                                                                             & =\det\big( \tau_id\varphi u_1,\ldots, \tau_id\varphi u_{n-1} \big)
		\end{align}
	\end{subequations}
	where we used the lemma~\ref{LEMooICRXooFKPCRd}.

	What lies in the integral is the \( (n-1)\) differential form
	\begin{subequations}        \label{EQooEVAPooSbRfaj}
		\begin{align}
			(u_1,\ldots, u_{n-1})\mapsto \sum_{i}(-1)^iX_i & \det\big(    \tau_id\varphi u_1,\ldots, \tau_id\varphi u_{n-1}  \big) \\
			                                               & =\det\big( X,d\varphi u_1,\ldots, d\varphi u_{n-1} \big).
		\end{align}
	\end{subequations}
	Since this is a \( (n-1)\) differential form over \( \eR^{n-1}\), this has to be proportional to \( dy_1\wedge\ldots dy_{n-1}\). The proportionality factor is found by applying \eqref{EQooEVAPooSbRfaj} to the basis \( \{ e_1,\ldots, e_n \}\). Since \( d\varphi(e_i)=\frac{ \partial \varphi }{ \partial y_i }\) we have the proportionality factor
	\begin{equation}
		\det\left( X,\frac{ \partial \varphi }{ \partial y_1 },\ldots, \frac{ \partial \varphi }{ \partial y_n } \right)
	\end{equation}
	and the integral to be computed is
	\begin{equation}
		\int_A\det\left( X,\frac{ \partial \varphi }{ \partial y_1 },\ldots, \frac{ \partial \varphi }{ \partial y_n } \right)dy_1\wedge\ldots\wedge dy_{n-1}=\int_A\det\left( X,\frac{ \partial \varphi }{ \partial y_1 },\ldots, \frac{ \partial \varphi }{ \partial y_n } \right).
	\end{equation}
	The formula \eqref{SUBEQooWJSPooImJjQN} is proven. The two others are application of lemma~\ref{LEMooFRWKooVloCSM}.
\end{proof}

\begin{example}
	Let us make the example with \( n=3\). We have
	\begin{equation}
		\varphi^*(dx\wedge dy)(v_1,v_2)=(dx\wedge dy)(d\varphi v_1 , d\varphi v_2)=\det
		\begin{pmatrix}
			d\varphi(v_1)_x & d\varphi(v_2)_x \\
			d\varphi(v_1)_y & d\varphi(v_2)_y
		\end{pmatrix},
	\end{equation}
	and then
	\begin{equation}
		\sum_i(-1)^iX_i \varphi^*(   \Wedge_{k\neq i}dx_k    )(v_1,v_2)=\sum_i(-1)^iX_i
		\begin{pmatrix}
			d\varphi(v_1)_x & d\varphi(v_2)_x \\
			d\varphi(v_1)_y & d\varphi(v_2)_y
		\end{pmatrix}=
		\det\begin{pmatrix}
			X_1 & d\varphi (v_1)_x & d\varphi(v_2)_x \\
			X_2 & d\varphi (v_1)_y & d\varphi(v_2)_y \\
			X_3 & d\varphi (v_1)_z & d\varphi(v_2)_z
		\end{pmatrix}
	\end{equation}
\end{example}

%---------------------------------------------------------------------------------------------------------------------------
\subsection{Integrating by part}
%---------------------------------------------------------------------------------------------------------------------------

\begin{proposition}[\cite{MonCerveau}]
	Let \( \Omega\) be an open set in an manifold \( M\) of dimension \( n\) and \( \varphi\colon A\to \eR^n\) be a parametrisation of the boundary \( \partial\Omega\) with tangent vector field \( n\) (defined on \( \partial\Omega\)). Let \( u,v\in  C^{\infty}(M)\). Then we have
	\begin{equation}        \label{EQooQSMNooKHwbqp}
		\int_{\partial \Omega}uv\,n_j=\int_{\Omega}\frac{ \partial u }{ \partial x_j }v+\int_{\Omega}u\frac{ \partial v }{ \partial x_j }.
	\end{equation}
\end{proposition}

\begin{proof}
	We use the Stokes formula (theorem~\ref{ThoATsPuzF}) on the \( (n-1)\)-form
	\begin{equation}
		\omega=uv\,dx_1\wedge\ldots\wedge\widehat{dx_j}\wedge\ldots\wedge dx_n,
	\end{equation}
	and we know from example~\ref{EXooCIYIooFPMLMU} that \( \omega=(-1)^{j+1}\hodge dx_j\). On the other hand,
	\begin{equation}
		d\omega=\sum_k\frac{ \partial (uv) }{ \partial x_k }dx_j\wedge dx_1\wedge\ldots\wedge\widehat{dx_j}\wedge\ldots\wedge dx_n=\frac{ \partial (uv) }{ \partial x_j }(-1)^{j+1}dx_1\wedge\ldots\wedge dx_n.
	\end{equation}
	We can use the Stokes formula :
	\begin{equation}
		\int_{\partial \Omega} uv dx_1\wedge\ldots\wedge\widehat{dx_j}\wedge\ldots\wedge dx_n=  (-1)^{j+1} \int_{\Omega}\frac{ \partial (uv) }{ \partial x_j }.
	\end{equation}
	The left-hand side can be transformed as
	\begin{equation}
		\int_{\partial\Omega}\hodge(dx_j)=\int_{\partial\Omega}uv\partial_j=\int_{\partial\Omega}uv\,n_j
	\end{equation}
	where we used the definition~\ref{DEFooAXFXooWiMLKP} and the proposition~\ref{PROPooETLZooAVsrwy}.

	The coefficients \( (-1)^{j+1}\) simplify and the derivation of product produce the result.
\end{proof}

\begin{example}     \label{EXooWLUVooNamnKG}
	If we integrate by part the function \( u\frac{ \partial^2 v }{ \partial x_j^2 }\) we have
	\begin{equation}
		\int_{\omega}u\frac{ \partial^2 }{ \partial x_j^2 }=-\int_{\Omega}\frac{ \partial u }{ \partial x_j }\frac{ \partial v }{ \partial x_j }+\int_{\partial \Omega}u\frac{ \partial v }{ \partial x_j }n_j.
	\end{equation}
	Summing over \( j\) we have the interesting formula
	\begin{equation}        \label{EQooJLDTooIMtxEX}
		\int_{\Omega}u\Delta v=-\int_{\Omega}\nabla u\cdot\nabla v+\int_{\partial \Omega}u\frac{ \partial v }{ \partial n }
	\end{equation}
	where \( \Delta v=\sum_j\frac{ \partial^2v }{ \partial x_j^2 }\) and \( \frac{ \partial v }{ \partial n }\) is a notation for \( \nabla v\cdot n\).
\end{example}
